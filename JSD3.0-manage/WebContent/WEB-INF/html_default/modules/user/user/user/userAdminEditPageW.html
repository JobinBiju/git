<script type="text/javascript">
    $.fn.dataGridOptions.formSubFun2("#form",'/modules/user/user/user/userAdminEdit.html'); //表单提交  参数1：表单id 参数2：表单action地址		
</script>
<style>
 #professional,#sourceRepay{width:200px;}
</style>
<form id="form"  method="post" enctype="multipart/form-data">
<div class="adminUserForm">
	<ul>
		<li><span>借款人：</span><input type="text" maxlength="20" name="user.realName" value="${userCache.user.realName!}" class="easyui-validatebox adminUserTxt" data-options="required: true,validType:'chinese'" onkeyup="this.value=this.value.replace(/[^\u4E00-\u9FA5]/g,'')"/><i>*</i></li>
		<li><span>借款人身份证：</span><input type="text" maxlength="20" name="user.cardNO" value="${userCache.user.cardNO!}" class="easyui-validatebox adminUserTxt" data-options="required: true,validType:'idCard'" onkeyup="this.value=this.value.replace(/[^\w\.\/]/ig,'')"/><i>*</i></li>
		<li><span>借款人手机：</span><input type="text" maxlength="15" name="user.mobilePhone" value="${userCache.user.mobilePhone!}" class="easyui-validatebox adminUserTxt" data-options="required: true,validType:'mobile'" onkeyup="value=value.replace(/[^1234567890-]+/g,'')"/><i>*</i></li>

		<!-- <li><span>借款人：</span><input type="text" name="user.realName" value="${userCache.user.realName!}" class="easyui-validatebox adminUserTxt" data-options="required: true,validType:'chinese'"/><i>*</i></li>
		<li><span>借款人身份证：</span><input type="text" name="user.cardNO" value="${userCache.user.cardNO!}" class="easyui-validatebox adminUserTxt" data-options="required: true,validType:'idCard'"/><i>*</i></li>
		<li><span>借款人手机：</span><input type="text" name="user.mobilePhone" value="${userCache.user.mobilePhone!}" class="easyui-validatebox adminUserTxt" data-options="required: true,validType:'mobile'"/><i>*</i></li>
 -->
		<li><span>借款人邮箱：</span>${userCache.user.email!}</li>
		<li><span>岗位职位：</span><input type="text" maxlength="30"name="position" autocomplete="off" value="${userCache.position!}" class="easyui-validatebox adminUserTxt" data-options="required: true,validType:'notNull'"/><i>*</i></li>
		<li><span>婚姻状况：</span>
		<input type="radio" name="maritalStatus" class="easyui-validatebox" <#if maritalStatus=='1'>checked="checked"</#if> value="1"/>已婚
		<input type="radio" name="maritalStatus" class="easyui-validatebox" <#if maritalStatus=='2'>checked="checked"</#if> value="2"/>未婚
		</li>
		<li><span>法人账户提现：</span>
			<input type="radio" name="legalDraw" class="easyui-validatebox" value="1" <#if legalDrawP=='1'>checked="checked"</#if> />是
			<input type="radio" name="legalDraw" class="easyui-validatebox" value="2" <#if legalDrawP=='2'>checked="checked"</#if>/>否
		</li>
	</ul>
</div>
<div class="adminUserForm">
	<ul>
		<li><span>公司名称：</span><input type="text" maxlength="20" name="companyName" value="${userCache.companyName}"  onkeyup="this.value=this.value.replace(/[, ]/g,'')" class="easyui-validatebox adminUserTxt" /><!-- <i>*</i> --></li>
		<li><span>公司类型：</span>
		<@linkage name="companyType" id="style" type="value" nid="company_type" default="${userCache.companyType!}"/>
		</li>
		<!-- <li><span>公司标志：</span><input type="file" name="files" class="adminUserTxt" /></li> -->
		<li><span>公司注册号：</span><input type="text" name="companyRegNo" value="${userCache.companyRegNo}" maxlength="15" class="easyui-validatebox adminUserTxt" /><!-- <i>*</i> --></li>
		<li><span>税务登记证号：</span><input type="text" name="companyTaxNo" value="${userCache.companyTaxNo}" maxlength="20" class="easyui-validatebox adminUserTxt"/></li>
		<li><span>所属行业：</span><@linkage name="professional" id="professional" default="${userCache.professional!}" type="value" nid="professional"/></li>
	</ul>
	<div class="adminUserMuti">
		<span style="line-height:40px;">公司地区：</span>
	    <select name="province" id="province">
			<option value="">请选择</option>
		</select> 
		<select name="city" id="city">
			<option value="">请选择</option>
		</select> 
		<select id="county" name="area" >
			<option value="">请选择</option>
		</select>  
		
	</div>
	<div class="adminUserMuti"><span>还款来源：</span>
		<@linkage name="sourceRepay" id="sourceRepay" type="value" default="${userCache.sourceRepay!}" nid="repayment_source"/>
	</div>
	<div class="adminUserMuti"><span>公司地址：</span><textarea name="address" maxlength="50" class="easyui-validatebox adminUserTextarea" maxlength="50" >${userCache.address}</textarea><!-- <i>*</i> --></div>
	<div class="adminUserMuti"><span>公司描述：</span><textarea name="companyDesc" maxlength="100" class="easyui-validatebox adminUserTextarea" >${userCache.companyDesc}</textarea><i>*</i></div>
	<div class="adminUserMuti"><span>经营状况：</span><textarea name="companyStatus" maxlength="100" autocomplete="off" class="easyui-validatebox adminUserTextarea" ><#if userCache.companyStatus??>${userCache.companyStatus}</#if></textarea><!-- <i>*</i> --></div>
</div>
<div class="adminUserForm">
	<ul>
		<li><span>法人姓名：</span><input type="text" maxlength="20" name="companyLawPerson" value="${userCache.companyLawPerson}" class="easyui-validatebox adminUserTxt"  onkeyup="this.value=this.value.replace(/[^\u4E00-\u9FA5]/g,'')"/><!-- <i>*</i> --></li>
		<li><span>法人身份证：</span><input type="text" maxlength="20" name="companyLawPersonCardno" value="${userCache.companyLawPersonCardno}" class="easyui-validatebox adminUserTxt"   onkeyup="this.value=this.value.replace(/[^\w\.\/]/ig,'')"/><!-- <i>*</i> --></li>
		<li class="regCapital"><span>注册资本：</span><input type="text" name="companyRegCapital" maxlength="11" value="${userCache.companyRegCapital}" class="easyui-validatebox adminUserTxt" /><!-- <i>*</i> --></li>
		<li><span>组织机构代码号：</span><input type="text" maxlength="25" name="companyOrgCode" value="${userCache.companyOrgCode}" class="easyui-validatebox adminUserTxt" onkeyup="this.value=this.value.replace(/[^\w\.\/]/ig,'')"/></li>
	</ul>
</div>

<div class="adminUserForm">
	<ul>
		<li><span>公司电话：</span><input type="text" maxlength="15" name="companyPhone" value="${userCache.companyPhone!}" class="easyui-validatebox adminUserTxt"   onkeyup="value=value.replace(/[^1234567890-]+/g,'')"/><!-- <i>*</i> --></li>
		<li><span>公司传真：</span><input type="text" maxlength="15" name="companyFax" value="${userCache.companyFax!}" class="easyui-validatebox adminUserTxt" data-options="validType:'fax'" onkeyup="value=value.replace(/[^1234567890-]+/g,'')"/></li>
		<li><span>公司邮件：</span><input type="text" maxlength="30" name="companyEmail" value="${userCache.companyEmail!}" class="easyui-validatebox adminUserTxt" data-options="validType:'email'" onkeyup="this.value=this.value.replace(/^ +| +$/g,'')"/></li>
	</ul>
</div>
<div class="adminUserForm">
	<dl>
		<dt><span>经营执照：</span><input type="file" name="files" class="adminUserTxt" data-options="required: true" accept="image/*"/></dt>
		<dd><#if userCache.jyzzPicPath??><a href="${userCache.jyzzPicPath!}" class="fileshow"><img src="${userCache.jyzzPicPath!}" /></a></#if></dd>
	</dl>
	<dl>
		<dt class="taxRegNo"><span>税务登记证：</span><input type="file" name="files" class="adminUserTxt" accept="image/*"/></dt>
		<dd><#if userCache.swdjPicPath??><a href="${userCache.swdjPicPath!}" class="fileshow"><img src="${userCache.swdjPicPath!}"></a></#if></dd>
	</dl>
	<dl>
		<dt class="zzjgCode"><span>组织机构证：</span><input type="file" name="files" class="adminUserTxt" accept="image/*"/></dt>
		<dd><#if userCache.zzjgPicPath??><a href="${userCache.zzjgPicPath!}" class="fileshow"><img src="${userCache.zzjgPicPath!}"></a></#if></dd>
	</dl>
	<dl>
		<dt><span>开户许可证：</span><input type="file" name="files" class="adminUserTxt" accept="image/*"/></dt>
		<dd><#if userCache.khxkPicPath??> <a href="${userCache.khxkPicPath!}" class="fileshow"><img src="${userCache.khxkPicPath!}"></a></#if></dd>
	</dl>
	<dl>
		<dt><span>贷款卡记录：</span><input type="file" name="files" class="adminUserTxt" accept="image/*"/></dt>
		<dd><#if userCache.dkkPicPath??><a href="${userCache.dkkPicPath!}" class="fileshow"><img src="${userCache.dkkPicPath!}"></a></#if></dd>
	</dl>
	<dl>
		<dt><span>个人征信报告：</span><input type="file" name="files" class="adminUserTxt" accept="image/*"/></dt>
		<dd><#if userCache.grzxPicPath??><a href="${userCache.grzxPicPath!}" class="fileshow"><img src="${userCache.grzxPicPath!}"></a></#if></dd>
	</dl>
</div>
<div class="borrowForm" style="border-bottom:0;">
	<h2 class="borrowFormTitle">公司照</h2>
	<div class="guarantee_type">
		<span>公司照：</span>
        <div id="entGuaranteeShowBox" style="height: auto;">
        	<ul id="uploadPiclist333" class="photoUpload" style="list-style: none; padding: 0; margin: 0;">
                <li class="add_btn" style="float: left;">
                  <i class="a"></i> <i class="b"></i>
                  <input type="file" name="file" id="uploadFile4" accept="image/*" onchange="return ajaxFileUpload1('uploadFile4','/imageUp.jsp','picPath','4');" title="点击上传图片" />
                </li>
            </ul>
       </div>
	</div>	
</div>
<input type="hidden" name="fileIndex" id="fileIndex" />
<input type="hidden" name="fileSize" id="fileSize" />
<input type="hidden" name="id" value="${userCache.userId}" />
<input type="hidden" name="userType" value="${userCache.userType!}">
<input type="hidden" name="borrowType" value="${userCache.borrowType!}"/>

<input type="hidden" value="${userAdminEditToken!}" name="userAdminEditToken">
</form>
<script>
	$(function(){
		$("#form").submit(function(){
			var files = $("input[name='files']");
			var fileIndex = "";
			for(var i = 0; i < files.length; i++){
				if(files[i].value != ""){
					fileIndex = fileIndex+i+",";
				}
			}
			$("#fileIndex").val(fileIndex.substring(0,fileIndex.length-1));
			$("#fileSize").val(files.length);
		});
		
	});
/* 	$("#city").citySelect({
		url:"${theme_dir}/js/jquery-citySelect/city.json",
		<#if userCache.province??>
		prov:"${userCache.province}", //省份 
	    city:"${userCache.city!}", //城市 
	    dist:"${userCache.area!}", //区县 
		<#else>
		prov:"${userCache.city!}", //省份 
	    city:"${userCache.area!}", //城市 
		</#if>
	    required:true,
	    nodata:"none" //当子集无数据时，隐藏select 
	}); */
	//担保函列表
	$.ajax({
		url:"/modules/user/user/user/getUserPic.html?id=${userCache.user.userId}",
		type:"get",
		dataType:"json",
		success:function(data){
			if(data.list.length > 0){
				for(var i = 0;i < data.list.length; i++){
					var sHtml = "";
					sHtml += '<li data-mum="' + data.list[i].id + '">';
					sHtml += '<a href="' + data.list[i].picPath + '" class="fileshow" rel="group1"><img src="' + data.list[i].picPath + '" alt="" style="width:100px;height:100px;float:left;"></a>';
					sHtml += '<a class="closePic" style="float:left;" href="javascript:;" title="删除图片">x</a>';
					sHtml += '</li>';
					$(".photoUpload").append(sHtml);
				}
			}
		}
	});
</script>
<script type="text/javascript">
	seajs.use("${theme_dir}/js/ajaxfileupload");
	seajs.use("${theme_dir}/js/upload");
</script>
<script type="text/javascript">
	//图片预览
	$(".fileshow").fancybox();
	
	$("#style").change(function(){
		var selectVal= $("#style").val();
		if(selectVal==4){
			$(".taxRegNo").html('<span>税务登记证：</span><input type="file" accept="image/*" name="files" class="adminUserTxt"/>');
			$(".regCapital").html('<span>注册资本：</span><input type="text" name="regCapital" value="${userCache.companyRegCapital}" autocomplete="off" class="easyui-validatebox adminUserTxt" />');
			$(".zzjgCode").html('<span>组织机构证：</span><input type="file" accept="image/*" name="files" class="adminUserTxt"/>');
		}else{
			$(".taxRegNo").html('<span>税务登记证：</span><input type="file" accept="image/*" name="files" class="adminUserTxt"/>');
			$(".regCapital").html('<span>注册资本：</span><input type="text" name="regCapital" value="${userCache.companyRegCapital}" autocomplete="off" class="easyui-validatebox adminUserTxt" data-options="required: true"/><i>*</i>');
			$(".zzjgCode").html('<span>组织机构证：</span><input type="file" accept="image/*" name="files" class="adminUserTxt"/>');
		}
	});
	
	
	
	

	/*
	 *初始化省份选择框
	 * */
	$.ajax({
        type:"get",
        url:"/modules/user/user/user/regionList.html",
        dataType:"json",
        success:function(json){
        	
        	 for(i=0;i<json.length;i++) {                                                                                                                                                                                        
        		 var province=json[i];
        		 if(province.id=="${userCache.province}"){
        			 $("#province").append("<option value="+province.id+" selected='selected'>"+province.name+"</option>");
        			 getEditcity(${userCache.province});
        		 }else{
        		 	 $("#province").append("<option value="+province.id+">"+province.name+"</option>");
        		 }
        	 }
        }
    });
	
	//根据id获取city
	function getEditcity(id){
		$.ajax({
	        type:"get",
	        url:"/modules/user/user/user/regionList.html",
	        dataType:"json",	        
	        data:{
	        	pId:id
	        },
	        success:function(json){
	        	 for(i=0;i<json.length;i++) {                                                                                                                                                                                        
	        		  var city=json[i];
	        		  if(city.id=="${userCache.city}"){
	        			  
	        		  	  $("#city").append("<option value="+city.id+" selected='selected'>"+city.name+"</option>");
	        		  	  
	        		  	  getEditArea(${userCache.city!});
	        		  }else{
	        			  $("#city").append("<option value="+city.id+" >"+city.name+"</option>");
	        		  }
	        	 }
	        }
	    });
	}
	
	
	
	//根据id获取country
	function  getEditArea(id){
		//ajax逻辑
		$.ajax({
	        type:"get",
	        url:"/modules/user/user/user/regionList.html",
	        dataType:"json",	        
	        data:{
	        	pId:id
	        },
	        success:function(json){
	        	 for(i=0;i<json.length;i++) {                                                                                                                                                                                        
	        		  var county=json[i];
	        		  if(county.id=="${userCache.area}"){
	        			  $("#county").append("<option value="+county.id+" selected='selected'>"+county.name+"</option>");
	        		  }else{
	        		      $("#county").append("<option value="+county.id+">"+county.name+"</option>");
	        		  }
	        	 }
	        }
	    });
		
	}
	//给省份下拉选择框注册change事件 
	 $("#province").change(function(){
		 $("#city").empty();
		 $("#city").append("<option value=''>请选择</option>");
		 var id = $(this).val();
		 if($(this).val() != ''){
		 	getcity(id);
		 }else{
		 	 $("#county").empty();
			 $("#county").append("<option value=''>请选择</option>");
		 }
	 });
	
	
	/*省份发生变化
	 *AJAX一步后台获取与此省份关联的城市
	 * 
	 * */
	function  getcity(id){
		//ajax逻辑
		
		$.ajax({
	        type:"get",
	        url:"/modules/user/user/user/regionList.html",
	        dataType:"json",	        
	        data:{
	        	pId:id
	        },
	        success:function(json){
	        	 for(i=0;i<json.length;i++) {                                                                                                                                                                                        
	        		  var city=json[i];
	        		 $("#city").append("<option value="+city.id+">"+city.name+"</option>");
	        	 }
	        }
	    });
		
	}
	
	/*给城市选择框注册change事件*/
	$("#city").change(function(){
		 $("#county").empty();
		 $("#county").append("<option value=''>请选择</option>");
		var id = $(this).val();
		if(id!=''){
			getcounty(id);
		}
	});

	/*城市发生变化
	 *AJAX一步后台获取与此市关联的县（区）
	 * 
	 * */
	function getcounty(id){
		//ajax逻辑
		$.ajax({
	        type:"get",
	        url:"/modules/user/user/user/regionList.html",
	        dataType:"json",	        
	        data:{
	        	pId:id
	        },
	        success:function(json){
	        	 for(i=0;i<json.length;i++) {                                                                                                                                                                                        
	        		  var county=json[i];
	        		 $("#county").append("<option value="+county.id+">"+county.name+"</option>");
	        	 }
	        }
	    });
		
	}
</script>
